{% extends "polls/base.html" %}

{% load static %}
{% load humanize %}

{% block content %}

    <div class="container">
        <h1>My Polls</h1>
        <hr />

        {% if questions %}
            <div class="question-list">
            {% for question in questions %}
                 <!-- main part of question -->
                <div class="question">
                    <h4 class="question-title">
                        <a href="{% url 'polls:results' question.id %}">{{ question.question_text }}</a>
                    </h4>
                    <span class="question-dropdown-icon" title="Preview" dropdown-id="dropdown{{ question.id }}">
                        <i class="far fa-caret-square-down fa-lg is-clickable"></i>
                    </span>
                    <p class="question-text-left">
                        {{ question.total_votes }} vote{{ question.total_votes|pluralize }}
                    </p>
                    <p class="question-text-right">
                        Created {{ question.pub_date|naturaltime }}
                    </p>
                </div>
                <!-- dropdown of question -->
                <div class="question-dropdown" id="dropdown{{ question.id }}">
                    <div class="question-dropdown-content l-2-col">
                        <div class="l-2-col-left">
                            <ul>
                            {% for choice in question.choice_set.all %}
                                <li>{{ choice.choice_text }}</li>
                            {% endfor %}
                            </ul>
                        </div>
                        <div class="l-2-col-right">
                            <button class="btn-danger" id="delete-btn-{{ question.id }}" link="{% url 'polls:delete' question.id %}">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>
        {% else %}
            <p>You have no polls!</p>
        {% endif %}

        <hr />
        <button class="btn l-center" id="create-btn">Create new question</button>

    </div>

{% endblock %}

{% block modal %}
    <div class="modal" id="modal">
        TEST
    </div>
{% endblock %}

{% block scripts %}
    <script src={% static 'polls/js/question_dropdown.js' %}></script>
    <script>
    $(function() {
        // id starts with "delete-btn-"
        $('[id^="delete-btn-"]').click(function() {
            location.href = $(this).attr('link');
        });
        $('#create-btn').click(function() {
            location.href = "{% url 'polls:create' %}";
        });
    });
    </script>
{% endblock %}